load("@better_rules_javascript//commonjs:rules.bzl", "cjs_root")
load("@better_rules_javascript//javascript:rules.bzl", "js_file", "js_library")
load("@better_rules_javascript//nodejs:rules.bzl", "nodejs_simple_binary")
load("@better_rules_javascript//webpack:rules.bzl", "configure_webpack", "webpack_bundle")

cjs_root(
    name = "root",
    package_name = "@better-rules-javascript_test/webpack-basic",
    descriptors = ["package.json"],
)

js_library(
    name = "lib",
    srcs = [
        "index.js",
        "lib.js",
    ],
    root = ":root",
)

js_file(
    name = "webpack_config",
    src = "webpack.config.js",
    root = ":root",
)

configure_webpack(
    name = "webpack",
    cli = "@better_rules_javascript_npm//webpack-cli:lib",
    config = ":webpack_config",
    dev_server = "@better_rules_javascript_npm//webpack-dev-server:lib",
    other_deps = ["@better_rules_javascript_npm_webpack_cli_configtest1.1.0//:lib"],
    webpack = "@better_rules_javascript_npm//webpack:lib",
)

webpack_bundle(
    name = "bundle",
    dep = ":lib",
    webpack = ":webpack",
)

nodejs_simple_binary(
    name = "bin",
    src = ":bundle",
)
